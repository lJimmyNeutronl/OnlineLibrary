# План разработки административной панели

## Общая концепция

Разработка административной панели для онлайн-библиотеки с использованием React-Admin. Основная цель - создать функциональную админ-панель с минимальными затратами времени, используя готовые компоненты и существующий API. Панель должна поддерживать два типа ролей: SUPERADMIN (единственный, может управлять всем) и ADMIN (может управлять контентом, но не пользователями).

## Этап 1: Подготовка backend

### Система ролей и безопасность
Необходимо расширить существующую систему ролей добавлением роли SUPERADMIN. Критически важно обеспечить уникальность суперадмина - в системе может быть только один пользователь с такой ролью. 

В enum Role добавляется новое значение SUPERADMIN. В базе данных создается миграция Flyway для добавления новой роли. При первом запуске системы автоматически создается единственный суперадмин через DataLoader или InitializationRunner.

### Защита от компрометации суперадмина
На уровне сервисов реализуются проверки, которые не позволяют:
- Создать второго суперадмина
- Изменить роль существующего суперадмина
- Удалить суперадмина
- Суперадмину удалить самого себя

В SecurityConfig обновляются аннотации @PreAuthorize для разграничения доступа между ADMIN и SUPERADMIN ролями.

### API для административных функций
Создается минимальный набор дополнительных методов в контроллерах:
- В UserController добавляется метод получения списка всех пользователей и назначения роли ADMIN
- Существующие BookController и CategoryController используются без изменений
- Все административные методы защищаются соответствующими аннотациями безопасности

## Этап 2: Установка и настройка React-Admin

### Установка зависимостей
Устанавливаются минимально необходимые пакеты: react-admin, ra-data-simple-rest, ra-language-russian для русификации интерфейса. Также добавляются Material-UI компоненты, которые React-Admin использует по умолчанию.

### Структура проекта
В директории src создается папка admin с базовой структурой:
- AdminApp.tsx - главное приложение админ-панели
- authProvider.ts - провайдер аутентификации, интегрированный с существующей JWT системой
- dataProvider.ts - провайдер данных для работы с REST API

### Интеграция с существующей авторизацией
authProvider настраивается для работы с существующими JWT токенами. Проверяется что пользователь имеет роль ADMIN или SUPERADMIN. dataProvider настраивается на существующий API без дополнительных изменений, используя стандартный ra-data-simple-rest.

## Этап 3: Управление пользователями (только SUPERADMIN)

### Основной функционал
Создаются стандартные компоненты React-Admin для работы с пользователями: List для отображения списка, Edit для редактирования, Create для создания новых админов. Используются готовые компоненты без кастомизации дизайна.

### Ограничения безопасности
Ресурс users отображается только для пользователей с ролью SUPERADMIN. В интерфейсе скрываются возможности редактирования и удаления пользователей с ролью SUPERADMIN. Добавляются предупреждения при критических операциях типа назначения роли ADMIN.

## Этап 4: Управление книгами

### Переиспользование существующего API
Подключается существующий BookController без изменений. Используются стандартные компоненты List, Edit, Create из React-Admin. Добавляются базовые фильтры и сортировка из коробки.

### Массовый импорт книг
Создается простой компонент для загрузки CSV файла с метаданными книг. Файлы книг в облачное хранилище загружаются отдельно, вручную. В CSV указываются только URL уже загруженных файлов. Реализуется базовая валидация данных и отображение ошибок импорта.

Формат CSV файла должен включать: title, author, description, isbn, publication_year, publisher, language, page_count, file_url, cover_image_url, category_ids.

## Этап 5: Управление категориями

### Простая реализация
Используется существующий CategoryController без изменений. Стандартные компоненты React-Admin для отображения и редактирования категорий. Поддержка иерархической структуры реализуется через стандартный ReferenceInput для выбора родительской категории.

Сложные функции типа drag-and-drop для изменения иерархии не реализуются для упрощения разработки.

## Этап 6: Дашборд и статистика

### Минимальный дашборд
Создается простой компонент Dashboard с базовыми метриками: количество пользователей, книг, категорий, отзывов. Статистика получается через простые API вызовы к существующим контроллерам.

### Разграничение по ролям
SUPERADMIN видит полную статистику включая количество админов. ADMIN видит только статистику по контенту (книги, категории, отзывы). Сложные графики и аналитика не реализуются.

## Этап 7: Интеграция с основным приложением

### Маршрутизация
В основное приложение добавляется маршрут /admin/* с компонентом AdminRoute, который проверяет наличие роли ADMIN или SUPERADMIN. При отсутствии прав происходит перенаправление на страницу входа.

### Навигация
В header основного сайта для пользователей с административными правами добавляется ссылка на админ-панель. В админ-панели добавляется ссылка для возврата на основной сайт.

## Этап 8: Тестирование и безопасность

### Проверка безопасности
Обязательно тестируются все сценарии нарушения безопасности:
- Попытки создания второго суперадмина
- Попытки изменения роли суперадмина
- Попытки доступа обычных админов к функциям суперадмина
- Правильность работы разграничения прав в интерфейсе

### Функциональное тестирование
Проверяется корректность всех CRUD операций, работа массового импорта книг, правильность отображения статистики для разных ролей.

## Технические особенности

### Подготовка к контейнеризации
Админ-панель собирается вместе с основным frontend приложением. Все настройки API конфигурируются через переменные окружения. Учитывается что приложение будет работать в Docker контейнере.

### Принципы разработки
Приоритет отдается функциональности над красотой интерфейса. Используются стандартные компоненты React-Admin без кастомизации. Минимум собственного кода - максимум готовых решений.



