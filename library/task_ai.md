# Онлайн-библиотека

## Описание проекта
Онлайн-библиотека - это веб-приложение, которое позволяет пользователям искать, просматривать и читать книги в электронном формате. Проект предоставляет удобный интерфейс для работы с книгами, систему категоризации, персональные функции для пользователей и административную панель.

### Основной функционал:
- Регистрация и авторизация пользователей
- Поиск книг по названию, автору и категориям
- Просмотр информации о книгах
- Онлайн-чтение книг в формате PDF
- Сохранение прогресса чтения
- Добавление книг в избранное
- Административная панель для управления контентом

### Технологический стек:
- **Backend**: Java 21, Spring Boot, Spring Security, Spring Data JPA
- **Frontend**: React, Redux, React Router
- **База данных**: PostgreSQL
- **Миграции**: Flyway
- **Аутентификация**: JWT (JSON Web Tokens)
- **Хранение файлов**: Облачное хранилище (AWS S3 или аналог)
- **Сборка**: Maven
- **Контейнеризация**: Docker (опционально)

### Архитектура:
Проект следует принципам REST API и многоуровневой архитектуры:
- Слой контроллеров для обработки HTTP-запросов
- Сервисный слой для бизнес-логики
- Репозитории для работы с базой данных
- DTO для передачи данных между слоями

# План разработки онлайн-библиотеки

## 1. Базовый функционал
- [x] 1.1. Определение базового функционала:
   - [x] Регистрация/авторизация пользователей (с личным кабинетом)
   - [x] Разделение ролей (пользователь, администратор)
   - [x] Поиск книг по категориям и через поисковую строку
   - [x] Просмотр информации о книге, онлайн-чтение (PDF)
   - [x] Добавление книг (только администраторами)

## 2. Разработка базы данных
- [x] 2.1. Проектирование схемы базы данных
- [x] 2.2. Визуализация схемы базы данных
- [x] 2.3. Создание миграций с помощью Flyway
- [x] 2.4. Реализация сущностей (Entity) для Hibernate
   - [x] 2.4.1. User (пользователь)
   - [x] 2.4.2. Role (роль)
   - [x] 2.4.3. UserRole (связь пользователя и роли)
   - [x] 2.4.4. Book (книга)
   - [x] 2.4.5. Category (категория)
   - [x] 2.4.6. BookCategory (связь книги и категории)
   - [x] 2.4.7. Favorite (избранное)
   - [x] 2.4.8. ReadingHistory (история чтения)

## 3. Настройка бэкенд-части (Java + Spring Boot)
- [x] 3.1. Инициализация Spring Boot проекта
- [x] 3.2. Настройка подключения к PostgreSQL
- [x] 3.3. Настройка Hibernate и Flyway
- [x] 3.4. Создание базовой структуры проекта (пакеты, классы)
- [x] 3.5. Решение проблем совместимости с Java 21

## 4. Реализация системы аутентификации и авторизации
- [x] 4.1. Настройка Spring Security
- [x] 4.2. Реализация регистрации пользователей
- [x] 4.3. Реализация авторизации пользователей
- [x] 4.4. Настройка ролей (пользователь, администратор)
- [x] 4.5. Создание JWT-токенов для аутентификации

## 5. Разработка REST API для бэкенда
- [x] 5.1. Создание контроллеров
   - [x] 5.1.1. AuthController (регистрация/авторизация)
   - [x] 5.1.2. BookController (поиск, просмотр, добавление книг)
   - [x] 5.1.3. CategoryController (работа с категориями)
   - [x] 5.1.4. UserController (личный кабинет, закладки, история)
- [x] 5.2. Реализация сервисного слоя
   - [x] 5.2.1. AuthService
   - [x] 5.2.2. BookService
   - [x] 5.2.3. CategoryService
   - [x] 5.2.4. UserService
- [x] 5.3. Реализация репозиториев для работы с БД
   - [x] 5.3.1. UserRepository
   - [x] 5.3.2. BookRepository
   - [x] 5.3.3. CategoryRepository
   - [x] 5.3.4. ReadingHistoryRepository

### 5.4. Взаимосвязь компонентов бэкенда

#### 5.4.1. Архитектура приложения
Приложение построено по многоуровневой архитектуре:
- **Контроллеры** - обрабатывают HTTP-запросы, валидируют входные данные и делегируют бизнес-логику сервисам
- **Сервисы** - содержат бизнес-логику, обрабатывают данные и взаимодействуют с репозиториями
- **Репозитории** - обеспечивают доступ к базе данных и выполняют CRUD-операции
- **Модели** - представляют сущности базы данных
- **DTO** - объекты для передачи данных между слоями

#### 5.4.2. Поток данных в приложении
1. Клиент отправляет HTTP-запрос на соответствующий эндпоинт
2. Контроллер принимает запрос, извлекает и валидирует данные
3. Контроллер вызывает соответствующий метод сервиса
4. Сервис выполняет бизнес-логику, при необходимости обращаясь к репозиториям
5. Репозитории выполняют операции с базой данных
6. Сервис обрабатывает результаты и возвращает данные контроллеру
7. Контроллер формирует HTTP-ответ и отправляет его клиенту

#### 5.4.3. Аутентификация и авторизация
1. Пользователь отправляет учетные данные на `/api/auth/signin`
2. AuthController вызывает AuthService для аутентификации
3. AuthService проверяет учетные данные через UserDetailsService и создает JWT-токен
4. При последующих запросах AuthTokenFilter проверяет JWT-токен и устанавливает аутентификацию
5. SecurityConfig определяет правила доступа к ресурсам на основе ролей пользователя

## 6. Интеграция с облачным хранилищем (для хранения книг)
- [x] 6.1. Выбор облачного провайдера (Яндекс.Облако Object Storage)
- [x] 6.2. Настройка подключения к хранилищу
- [x] 6.3. Реализация сервиса для загрузки книг в хранилище
- [x] 6.4. Реализация сервиса для получения книг из хранилища
- [x] 6.5. Удаление локального хранилища файлов и переход полностью на облачное хранение

## 7. Настройка фронтенд-части (React + Redux)
- [x] 7.1. Инициализация React-проекта
  - Создан проект с использованием Vite + React + TypeScript
  - Установлены основные зависимости: react, react-dom, typescript, @types/react, @types/react-dom
  - Настроен ESLint и Prettier для линтинга и форматирования кода
- [x] 7.2. Настройка Redux для управления состоянием
  - Установлены @reduxjs/toolkit и react-redux
  - Создан store с настройкой middleware
  - Реализован authSlice для управления состоянием аутентификации
- [x] 7.3. Настройка маршрутизации (React Router)
  - Установлен react-router-dom
  - Создана конфигурация маршрутов в App.tsx
  - Реализованы основные маршруты: /, /login, /register, /not-found
- [x] 7.4. Создание базовых компонентов
  - Создан MainLayout с Header и Footer
  - Реализованы страницы: HomePage, LoginPage, RegisterPage, NotFoundPage
  - Настроена интеграция с Ant Design для UI компонентов
- [x] 7.5. Настройка системы контроля версий (Git и GitHub)
  - Создан репозиторий на GitHub: https://github.com/lJimmyNeutronl/OnlineLibrary.git
  - Настроены две ветки разработки: main (стабильный код) и unstable (код в разработке)
  - Настроен .gitignore для исключения конфиденциальных файлов (application.properties)
  - Создан шаблон application.properties.template для безопасного обмена конфигурацией
  - Загружены исходные коды backend и frontend частей проекта в репозиторий

### Примечание о модели User'а
Важно: В базе данных модель User имеет следующую структуру:
- id (number)
- email (string)
- password (string)
- registration_date (timestamp)
- last_login_date (timestamp)
- first_name (string)
- last_name (string)

Поле username отсутствует в модели, поэтому в интерфейсах и формах следует использовать email для идентификации пользователя.

## 8. Разработка пользовательского интерфейса
- [x] 8.1. Реализация страницы регистрации/авторизации
- [x] 8.2. Реализация главной страницы с поиском книг
- [x] 8.3. Реализация страницы категорий
- [x] 8.4. Реализация страницы книги с возможностью чтения
- [x] 8.5. Реализация личного кабинета пользователя
   - [x] 8.5.1. Закладки
   - [x] 8.5.2. История чтения
- [x] 8.6. Реализация панели администратора
   - [x] 8.6.1. Добавление новых книг
   - [x] 8.6.2. Управление категориями
   - [x] 8.6.3. Управление пользователями

## 9. Интеграция фронтенда и бэкенда
- [ ] 9.1. Настройка взаимодействия с REST API
- [ ] 9.2. Реализация авторизации на клиенте
- [ ] 9.3. Реализация загрузки и отображения книг
- [ ] 9.4. Реализация поиска по книгам

### 9.5. Рефакторинг frontend-компонентов
#### Статус рефакторинга: в процессе (~15% завершено)
На данный момент успешно реализованы основные UI-компоненты, которые заменяют библиотеку Ant Design. Рефакторинг ProfilePage.tsx завершен, что является первым шагом в процессе полного избавления от зависимости от Ant Design. Однако большая часть работы по рефакторингу еще предстоит, включая обработку всех страниц и создание недостающих компонентов.

- [x] 9.5.1. Устранение зависимости от Ant Design
  - [x] Создание собственных компонентов UI для замены Ant Design
    - [x] Avatar - для отображения аватаров пользователей
    - [x] Tabs и TabPane - для создания вкладок
    - [x] List - для отображения списков с метаданными
    - [x] Tag - для отображения тегов/меток
    - [x] Breadcrumb - для навигационных цепочек
    - [x] Empty - для отображения пустых состояний
    - [x] Spin - для индикаторов загрузки
    - [x] Statistic - для отображения статистических данных
    - [x] Progress - для индикаторов прогресса
    - [x] message - для системных уведомлений
    - [x] Row и Col - для сеточной системы
    - [x] Card - для карточек с метаданными
    - [x] Button - для кнопок с различными стилями
    - [x] Typography (Title, Text, Paragraph) - для типографики
    - [x] Divider - для разделителей контента
    - [x] Icon - для отображения иконок (с использованием react-icons)
  - [x] Рефакторинг ProfilePage.tsx с заменой компонентов Ant Design
  - [ ] Рефакторинг BookDetailPage.tsx с заменой компонентов Ant Design
  - [ ] Рефакторинг оставшихся страниц с заменой компонентов Ant Design
- [ ] 9.5.2. Доработка навигации и маршрутизации
- [ ] 9.5.3. Интеграция с API бэкенда
  - [ ] Настройка запросов к бэкенду с использованием token-аутентификации
  - [ ] Обработка ответов и ошибок от API

### 9.6. Текущие проблемы и задачи
- [ ] 9.6.1. Завершить замену компонентов Ant Design на собственные реализации:
  - [ ] BookDetailPage.tsx - требуется заменить импорты и компоненты, включая Rate
  - [ ] HomePage.tsx - требуется рефакторинг
  - [ ] CategoriesPage.tsx - требуется рефакторинг
  - [ ] CategoryBooksPage.tsx - требуется рефакторинг
  - [ ] BookReaderPage.tsx - требуется рефакторинг
  - [ ] LoginPage.tsx - требуется рефакторинг
  - [ ] RegisterPage.tsx - требуется рефакторинг
  - [ ] NotFoundPage.tsx - требуется рефакторинг
  - [x] BooksPage.tsx - требуется рефакторинг
  - [ ] Админ-панель - требуется рефакторинг:
    - [ ] AdminDashboard.tsx
    - [ ] AdminBooks.tsx
    - [ ] AdminCategories.tsx
- [x] 9.6.2. Необходимо заменить компоненты от @ant-design/icons на компоненты react-icons
- [ ] 9.6.3. Разработать и интегрировать недостающие компоненты:
  - [x] Rate - для рейтинга книг
  - [x] Space - для управления отступами между компонентами
  - [ ] Form и связанные компоненты - для создания форм
  - [ ] Modal - для модальных окон
  - [ ] Dropdown - для выпадающих меню
  - [ ] Menu - для навигационных меню
  - [ ] Notification - для уведомлений
  - [ ] Table - для табличного отображения данных
- [ ] 9.6.4. Обеспечить совместимость CSS и стилей между собственными компонентами
- [ ] 9.6.5. Протестировать все страницы приложения после рефакторинга
- [ ] 9.6.6. Разработать единый интерфейс для использования собственных компонентов
- [ ] 9.6.7. Обеспечить поддержку анимаций (совместимость с библиотекой framer-motion)

## 10. Реализация функционала онлайнта-чтения
- [ ] 10.1. Интеграция PDF-просмотрщика
- [ ] 10.2. Реализация сохранения прогресса чтения
- [ ] 10.3. Реализация функции закладок

## 11. Тестирование

### 11.1. Тестирование аутентификации и авторизации
- [] 11.1.1. Проверка регистрации пользователя с валидными данными
- [] 11.1.2. Проверка регистрации пользователя с невалидными данными (email, пароль)
- [] 11.1.3. Проверка входа пользователя с валидными данными
- [] 11.1.4. Проверка входа пользователя с невалидными данными
- [ ] 11.1.5. Проверка доступа к защищенным ресурсам с валидным JWT-токеном
- [ ] 11.1.6. Проверка доступа к защищенным ресурсам без JWT-токена
- [ ] 11.1.7. Проверка доступа к ресурсам с разными ролями (пользователь, администратор)

### 11.2. Тестирование работы с книгами
- [] 11.2.1. Проверка получения списка всех книг
- [] 11.2.2. Проверка получения книги по ID
- [] 11.2.3. Проверка поиска книг по названию
- [] 11.2.4. Проверка поиска книг по автору
- [] 11.2.5. Проверка добавления новой книги (только для администраторов)
- [] 11.2.6. Проверка обновления информации о книге (только для администраторов)
- [] 11.2.7. Проверка удаления книги (только для администраторов)

### 11.3. Тестирование работы с категориями
- [] 11.3.1. Проверка получения списка всех категорий
- [] 11.3.2. Проверка получения категории по ID
- [] 11.3.3. Проверка получения книг по категории
- [] 11.3.4. Проверка добавления новой категории (только для администраторов)
- [] 11.3.5. Проверка обновления категории (только для администраторов)
- [] 11.3.6. Проверка удаления категории (только для администраторов)

### 11.4. Тестирование пользовательских функций
- [] 11.4.1. Проверка добавления книги в избранное
- [] 11.4.2. Проверка удаления книги из избранного
- [] 11.4.3. Проверка получения списка избранных книг пользователя
- [] 11.4.4. Проверка обновления истории чтения
- [] 11.4.5. Проверка получения истории чтения пользователя

### 11.5. Интеграционное тестирование
- [ ] 11.5.1. Тестирование взаимодействия контроллеров, сервисов и репозиториев
- [ ] 11.5.2. Тестирование транзакций и обработки ошибок
- [ ] 11.5.3. Тестирование взаимодействия с базой данных
- [ ] 11.5.4. Исправление ошибок в интеграционных тестах

### 11.6. Тестирование производительности
- [ ] 11.6.1. Нагрузочное тестирование API
- [ ] 11.6.2. Тестирование времени отклика при большом количестве пользователей
- [ ] 11.6.3. Исправление ошибок в тестах производительности
- [ ] 11.6.4. Тестирование производительности пользовательских функций
- [] 11.6.5. Создание простых тестов производительности для пользователей и книг
- [ ] 11.6.6. Тестирование производительности базы данных при большом объеме данных

## 12. Развертывание и документация
- [ ] 12.1. Настройка CI/CD для автоматического развертывания
- [ ] 12.2. Развертывание бэкенда
- [ ] 12.3. Развертывание фронтенда
- [ ] 12.4. Написание документации API
- [ ] 12.5. Написание руководства пользователя

## 13. Финальное тестирование и отладка
- [ ] 13.1. Проверка всего функционала
- [ ] 13.2. Исправление обнаруженных ошибок
- [ ] 13.3. Оптимизация производительности

## 14. Проделанная работа и оставшиеся задачи

### 14.1. Проделанная работа
- ✅ Настроен бэкенд на Spring Boot с базой данных PostgreSQL
- ✅ Реализована система аутентификации и авторизации
- ✅ Разработаны базовые API для работы с книгами, категориями и пользователями
- ✅ Настроено хранение файлов в облачном хранилище
- ✅ Создан frontend-проект на React + TypeScript
- ✅ Реализованы базовые компоненты пользовательского интерфейса
- ✅ Начат рефакторинг компонентов для устранения зависимости от Ant Design
- ✅ Полностью реализован ProfilePage с использованием собственных компонентов

### 14.2. Текущие проблемы
- 🔄 Зависимость от библиотеки Ant Design требует полного рефакторинга всех компонентов
- 🔄 Необходимо реализовать еще ряд собственных компонентов UI
- 🔄 Отсутствует полная интеграция фронтенда с бэкендом
- 🔄 Требуется настройка полноценного взаимодействия с API

### 14.3. Оставшиеся задачи (приоритет)
1. 🔺 Завершить рефакторинг всех страниц приложения, заменив компоненты Ant Design
2. 🔺 Реализовать недостающие UI-компоненты (Rate, Form, Modal и др.)
3. 🔺 Настроить взаимодействие фронтенда с API бэкенда
4. 🔺 Реализовать функционал онлайн-чтения книг (PDF)
5. 🔺 Разработать полноценный функционал административной панели
6. 🔺 Провести тестирование всего приложения
7. 🔺 Подготовить документацию и руководство пользователя
