# Онлайн-библиотека

## Описание проекта
Онлайн-библиотека - это веб-приложение, которое позволяет пользователям искать, просматривать и читать книги в электронном формате. Проект предоставляет удобный интерфейс для работы с книгами, систему категоризации, персональные функции для пользователей и административную панель.

### Основной функционал:
- Регистрация и авторизация пользователей
- Поиск книг по названию, автору и категориям
- Просмотр информации о книгах
- Онлайн-чтение книг в формате PDF
- Сохранение прогресса чтения
- Добавление книг в избранное
- Административная панель для управления контентом

### Технологический стек:
- **Backend**: Java 21, Spring Boot, Spring Security, Spring Data JPA
- **Frontend**: React, Redux, React Router
- **База данных**: PostgreSQL
- **Миграции**: Flyway
- **Аутентификация**: JWT (JSON Web Tokens)
- **Хранение файлов**: Облачное хранилище (AWS S3 или аналог)
- **Сборка**: Maven
- **Контейнеризация**: Docker (опционально)

### Архитектура:
Проект следует принципам REST API и многоуровневой архитектуры:
- Слой контроллеров для обработки HTTP-запросов
- Сервисный слой для бизнес-логики
- Репозитории для работы с базой данных
- DTO для передачи данных между слоями

# План разработки онлайн-библиотеки

## 1. Базовый функционал
- [x] 1.1. Определение базового функционала:
   - [x] Регистрация/авторизация пользователей (с личным кабинетом)
   - [x] Разделение ролей (пользователь, администратор)
   - [x] Поиск книг по категориям и через поисковую строку
   - [x] Просмотр информации о книге, онлайн-чтение (PDF)
   - [x] Добавление книг (только администраторами)

## 2. Разработка базы данных
- [x] 2.1. Проектирование схемы базы данных
- [x] 2.2. Визуализация схемы базы данных
- [x] 2.3. Создание миграций с помощью Flyway
- [x] 2.4. Реализация сущностей (Entity) для Hibernate
   - [x] 2.4.1. User (пользователь)
   - [x] 2.4.2. Role (роль)
   - [x] 2.4.3. UserRole (связь пользователя и роли)
   - [x] 2.4.4. Book (книга)
   - [x] 2.4.5. Category (категория)
   - [x] 2.4.6. BookCategory (связь книги и категории)
   - [x] 2.4.7. Favorite (избранное)
   - [x] 2.4.8. ReadingHistory (история чтения)

## 3. Настройка бэкенд-части (Java + Spring Boot)
- [x] 3.1. Инициализация Spring Boot проекта
- [x] 3.2. Настройка подключения к PostgreSQL
- [x] 3.3. Настройка Hibernate и Flyway
- [x] 3.4. Создание базовой структуры проекта (пакеты, классы)
- [x] 3.5. Решение проблем совместимости с Java 21

## 4. Реализация системы аутентификации и авторизации
- [x] 4.1. Настройка Spring Security
- [x] 4.2. Реализация регистрации пользователей
- [x] 4.3. Реализация авторизации пользователей
- [x] 4.4. Настройка ролей (пользователь, администратор)
- [x] 4.5. Создание JWT-токенов для аутентификации

## 5. Разработка REST API для бэкенда
- [x] 5.1. Создание контроллеров
   - [x] 5.1.1. AuthController (регистрация/авторизация)
   - [x] 5.1.2. BookController (поиск, просмотр, добавление книг)
   - [x] 5.1.3. CategoryController (работа с категориями)
   - [x] 5.1.4. UserController (личный кабинет, закладки, история)
- [x] 5.2. Реализация сервисного слоя
   - [x] 5.2.1. AuthService
   - [x] 5.2.2. BookService
   - [x] 5.2.3. CategoryService
   - [x] 5.2.4. UserService
- [x] 5.3. Реализация репозиториев для работы с БД
   - [x] 5.3.1. UserRepository
   - [x] 5.3.2. BookRepository
   - [x] 5.3.3. CategoryRepository
   - [x] 5.3.4. ReadingHistoryRepository

### 5.4. Взаимосвязь компонентов бэкенда

#### 5.4.1. Архитектура приложения
Приложение построено по многоуровневой архитектуре:
- **Контроллеры** - обрабатывают HTTP-запросы, валидируют входные данные и делегируют бизнес-логику сервисам
- **Сервисы** - содержат бизнес-логику, обрабатывают данные и взаимодействуют с репозиториями
- **Репозитории** - обеспечивают доступ к базе данных и выполняют CRUD-операции
- **Модели** - представляют сущности базы данных
- **DTO** - объекты для передачи данных между слоями

#### 5.4.2. Поток данных в приложении
1. Клиент отправляет HTTP-запрос на соответствующий эндпоинт
2. Контроллер принимает запрос, извлекает и валидирует данные
3. Контроллер вызывает соответствующий метод сервиса
4. Сервис выполняет бизнес-логику, при необходимости обращаясь к репозиториям
5. Репозитории выполняют операции с базой данных
6. Сервис обрабатывает результаты и возвращает данные контроллеру
7. Контроллер формирует HTTP-ответ и отправляет его клиенту

#### 5.4.3. Аутентификация и авторизация
1. Пользователь отправляет учетные данные на `/api/auth/signin`
2. AuthController вызывает AuthService для аутентификации
3. AuthService проверяет учетные данные через UserDetailsService и создает JWT-токен
4. При последующих запросах AuthTokenFilter проверяет JWT-токен и устанавливает аутентификацию
5. SecurityConfig определяет правила доступа к ресурсам на основе ролей пользователя

## 6. Интеграция с облачным хранилищем (для хранения книг)
- [x] 6.1. Выбор облачного провайдера (Яндекс.Облако Object Storage)
- [x] 6.2. Настройка подключения к хранилищу
- [x] 6.3. Реализация сервиса для загрузки книг в хранилище
- [x] 6.4. Реализация сервиса для получения книг из хранилища
- [x] 6.5. Удаление локального хранилища файлов и переход полностью на облачное хранение

## 7. Настройка фронтенд-части (React + Redux)
- [x] 7.1. Инициализация React-проекта
  - Создан проект с использованием Vite + React + TypeScript
  - Установлены основные зависимости: react, react-dom, typescript, @types/react, @types/react-dom
  - Настроен ESLint и Prettier для линтинга и форматирования кода
- [x] 7.2. Настройка Redux для управления состоянием
  - Установлены @reduxjs/toolkit и react-redux
  - Создан store с настройкой middleware
  - Реализован authSlice для управления состоянием аутентификации
- [x] 7.3. Настройка маршрутизации (React Router)
  - Установлен react-router-dom
  - Создана конфигурация маршрутов в App.tsx
  - Реализованы основные маршруты: /, /login, /register, /not-found
- [x] 7.4. Создание базовых компонентов
  - Создан MainLayout с Header и Footer
  - Реализованы страницы: HomePage, LoginPage, RegisterPage, NotFoundPage
  - Настроена интеграция с Ant Design для UI компонентов
- [x] 7.5. Настройка системы контроля версий (Git и GitHub)
  - Создан репозиторий на GitHub: https://github.com/lJimmyNeutronl/OnlineLibrary.git
  - Настроены две ветки разработки: main (стабильный код) и unstable (код в разработке)
  - Настроен .gitignore для исключения конфиденциальных файлов (application.properties)
  - Создан шаблон application.properties.template для безопасного обмена конфигурацией
  - Загружены исходные коды backend и frontend частей проекта в репозиторий

### Примечание о модели User'а
Важно: В базе данных модель User имеет следующую структуру:
- id (number)
- email (string)
- password (string)
- registration_date (timestamp)
- last_login_date (timestamp)
- first_name (string)
- last_name (string)

Поле username отсутствует в модели, поэтому в интерфейсах и формах следует использовать email для идентификации пользователя.

## 8. Разработка пользовательского интерфейса
- [x] 8.1. Реализация страницы регистрации/авторизации
- [x] 8.2. Реализация главной страницы с поиском книг
- [x] 8.3. Реализация страницы категорий
- [x] 8.4. Реализация страницы книги с возможностью чтения
- [x] 8.5. Реализация личного кабинета пользователя
   - [x] 8.5.1. Закладки
   - [x] 8.5.2. История чтения
- [x] 8.6. Реализация панели администратора
   - [x] 8.6.1. Добавление новых книг
   - [x] 8.6.2. Управление категориями
   - [x] 8.6.3. Управление пользователями

## 9. Интеграция фронтенда и бэкенда
- [x] 9.1. Настройка взаимодействия с REST API
- [x] 9.2. Реализация авторизации на клиенте
- [ ] 9.3. Реализация загрузки и отображения книг
- [ ] 9.4. Реализация поиска по книгам

### 9.5. Рефакторинг frontend-компонентов
#### Статус рефакторинга: завершен
Успешно реализованы собственные UI-компоненты, которые полностью заменили библиотеку Ant Design. Все страницы проекта теперь используют собственные компоненты.

- [x] 9.5.1. Создание собственных компонентов UI 
    - [x] Avatar - для отображения аватаров пользователей
    - [x] Tabs и TabPane - для создания вкладок
    - [x] List - для отображения списков с метаданными
    - [x] Tag - для отображения тегов/меток
    - [x] Breadcrumb - для навигационных цепочек
    - [x] Empty - для отображения пустых состояний
    - [x] Spin - для индикаторов загрузки
    - [x] Statistic - для отображения статистических данных
    - [x] Progress - для индикаторов прогресса
    - [x] message - для системных уведомлений
    - [x] Row и Col - для сеточной системы
    - [x] Card - для карточек с метаданными
    - [x] Button - для кнопок с различными стилями
    - [x] Typography (Title, Text, Paragraph) - для типографики
    - [x] Divider - для разделителей контента
    - [x] Icon - для отображения иконок (с использованием react-icons)
- [x] 9.5.2. Доработка навигации и маршрутизации
- [x] 9.5.3. Создание файла .env для безопасного хранения чувствительных данных и подготовка к будущей контейнеризации

# Текущие задачи

## 1. Аутентификация и регистрация пользователей
- [x] 1.1. Создание страницы регистрации (SignupPage)
  - [x] 1.1.1. Разработка UI формы регистрации с полями:
    - Email (обязательное, с валидацией email-формата)
    - Пароль (обязательное, мин. 6 символов)
    - Имя (опциональное)
    - Фамилия (опциональное)
  - [x] 1.1.2. Реализация валидации полей формы
  - [x] 1.1.3. Интеграция с бэкендом через эндпоинт `/api/auth/signup`
  - [x] 1.1.4. Обработка ошибок (уже существующий email и т.д.)
  - [x] 1.1.5. Перенаправление на страницу входа после успешной регистрации

- [x] 1.2. Создание страницы авторизации (LoginPage)
  - [x] 1.2.1. Разработка UI формы входа с полями:
    - Email (обязательное)
    - Пароль (обязательное)
  - [x] 1.2.2. Реализация валидации полей формы
  - [x] 1.2.3. Интеграция с бэкендом через эндпоинт `/api/auth/signin`
  - [x] 1.2.4. Сохранение JWT-токена в localStorage/Redux
  - [x] 1.2.5. Настройка редиректа на главную страницу после успешной авторизации
  - [x] 1.2.6. Обработка неверных учетных данных
  Так же необходимо привести дизайн к общему стилю всего приложения


## Прежде чем приступать к дальнейшему дизайну, надо будет внести кое-какие изменения в структуру фронтенда

## 2. Управление профилем пользователя
- [ ] 2.1. Создание страницы профиля пользователя (ProfilePage)
  - [ ] 2.1.1. Разработка UI страницы профиля с секциями:
    - Основная информация (имя, фамилия, email)
    - Статистика чтения (количество прочитанных книг, время чтения)
    - История чтения (список недавно прочитанных книг)
    - Избранные книги (список книг, добавленных в избранное)
  - [ ] 2.1.2. Интеграция с бэкендом через эндпоинт `/api/users/profile`
  - [ ] 2.1.3. Обработка случаев отсутствия данных или ошибок загрузки
  - [ ] 2.1.4. Добавление анимаций и переходов между секциями профиля

- [ ] 2.2. Редактирование профиля пользователя
  - [ ] 2.2.1. Разработка UI формы редактирования профиля с полями:
    - Имя (опциональное)
    - Фамилия (опциональное)
    - Загрузка аватара пользователя (опциональное)
  - [ ] 2.2.2. Реализация валидации полей формы
  - [ ] 2.2.3. Интеграция с бэкендом через эндпоинт `/api/users/update`
  - [ ] 2.2.4. Обработка ошибок и отображение сообщений об успешном обновлении
  - [ ] 2.2.5. Обновление данных пользователя в Redux после успешного редактирования

- [ ] 2.3. Управление безопасностью аккаунта
  - [ ] 2.3.1. Разработка UI формы изменения пароля с полями:
    - Текущий пароль (обязательное)
    - Новый пароль (обязательное, мин. 6 символов)
    - Подтверждение нового пароля (обязательное)
  - [ ] 2.3.2. Реализация валидации полей формы и проверки совпадения паролей
  - [ ] 2.3.3. Интеграция с бэкендом через эндпоинт `/api/users/change-password`
  - [ ] 2.3.4. Обработка ошибок и отображение сообщений об успешной смене пароля

- [ ] 2.4. История активности пользователя
  - [ ] 2.4.1. Разработка UI компонента истории активности с отображением:
    - Даты и времени последнего входа
    - Списка последних действий (начало чтения книги, добавление в избранное и т.д.)
    - Статистики активности по дням недели/месяцам
  - [ ] 2.4.2. Интеграция с бэкендом через эндпоинт `/api/users/activity`
  - [ ] 2.4.3. Реализация фильтрации и сортировки истории активности
  - [ ] 2.4.4. Визуализация данных в виде графиков и диаграмм (опционально)

- [ ] 2.5. Закладки и прогресс чтения
  - [ ] 2.5.1. Разработка UI компонента для отображения закладок и прогресса чтения
  - [ ] 2.5.2. Интеграция с бэкендом через эндпоинт `/api/users/bookmarks`
  - [ ] 2.5.3. Реализация возможности перехода к закладке и продолжения чтения
  - [ ] 2.5.4. Добавление индикаторов прогресса чтения для каждой книги

## 3. Каталог книг
- [ ] 3.1. Улучшение главной страницы и каталога книг

## 4. Детальная информация о книге
- [ ] 4.1. Доработка страницы детальной информации о книге

## 5. Поиск и фильтрация
- [ ] 5.1. Улучшение системы поиска и фильтрации книг

## 6. Система закладок и избранного
- [ ] 6.1. Реализация функционала для добавления книг в избранное

## 7. Чтение и скачивание книг
- [ ] 7.1. Разработка функционала для чтения книг онлайн
- [ ] 7.2. Реализация возможности скачивания книг

## 8. Отзывы и рейтинги
- [ ] 8.1. Система отзывов и рейтингов для книг

## 9. Административная панель
- [ ] 9.1. Разработка административного интерфейса

# Пункты плана остающиеся под вопросом (пока их не рассматриваем!)

### 9.6. 
- [ ] 9.6.1. Разработать и интегрировать недостающие компоненты:
  - [ ] Form и связанные компоненты - для создания форм
  - [ ] Modal - для модальных окон
  - [ ] Dropdown - для выпадающих меню
  - [ ] Menu - для навигационных меню
  - [ ] Notification - для уведомлений
  - [ ] Table - для табличного отображения данных
- [ ] 9.6.2. Интеграция с API бэкенда
  - [ ] Настройка запросов к бэкенду с использованием token-аутентификации
  - [ ] Обработка ответов и ошибок от API
- [ ] 9.6.3. Обеспечить совместимость CSS и стилей между компонентами
- [ ] 9.6.4. Протестировать все страницы приложения после интеграции с API
- [ ] 9.6.5. Реализация фильтрации и сортировки:
  - [ ] 9.6.5.1. Бэкенд:
    - [ ] Создание API для фильтрации по нескольким критериям (автор, год, рейтинг)
    - [ ] Реализация серверной сортировки с поддержкой различных полей
    - [ ] Оптимизация запросов к базе данных при фильтрации большого объема данных
    - [ ] Добавление пагинации результатов для повышения производительности
  - [ ] 9.6.5.2. Фронтенд:
    - [ ] Разработка компонентов фильтрации с поддержкой множественного выбора
    - [ ] Создание интерфейса сортировки с интуитивно понятным UX
    - [ ] Реализация кэширования результатов фильтрации на клиенте
    - [ ] Добавление индикации загрузки при фильтрации и сортировке
- [ ] 9.6.6. Протестировать все страницы приложения после интеграции с API
- [ ] 9.6.7. Реализация системы оценивания и отзывов:
  - [ ] 9.6.7.1. Бэкенд:
    - [ ] Создание моделей Review и Rating для хранения отзывов и оценок
    - [ ] Разработка API для добавления, редактирования и удаления отзывов
    - [ ] Реализация вычисления среднего рейтинга книги
    - [ ] Добавление защиты от накрутки рейтинга (один пользователь - одна оценка)
  - [ ] 9.6.7.2. Фронтенд:
    - [ ] Создание компонента звездного рейтинга для книг
    - [ ] Разработка формы для добавления отзывов с текстом и оценкой
    - [ ] Реализация отображения существующих отзывов на странице книги
    - [ ] Добавление возможности модерации отзывов для администраторов

## 10. Реализация функционала онлайн-чтения
- [ ] 10.1. Поддержка различных форматов книг:
  - [ ] 10.1.1. Интеграция PDF-просмотрщика (react-pdf)
  - [ ] 10.1.2. Добавление поддержки FB2 формата
  - [ ] 10.1.3. Добавление поддержки EPUB формата
  - [ ] 10.1.4. Создание универсального интерфейса для работы с разными форматами
- [ ] 10.2. Реализация инструментов чтения:
  - [ ] 10.2.1. Навигация по страницам
  - [ ] 10.2.2. Изменение масштаба
  - [ ] 10.2.3. Ночной режим чтения
- [ ] 10.3. Персонализация чтения:
  - [ ] 10.3.1. Сохранение прогресса чтения
  - [ ] 10.3.2. Реализация функции закладок
  - [ ] 10.3.3. Добавление аннотаций/заметок

## 11. Улучшение безопасности и администрирования
- [ ] 11.1. Защита создания администраторов:
  - [ ] 11.1.1. Создание системы приглашений для администраторов
  - [ ] 11.1.2. Реализация секретного ключа для регистрации администраторов
  - [ ] 11.1.3. Ограничение создания администраторов только существующими администраторами
- [ ] 11.2. Интеграция готовой административной панели:
  - [ ] 11.2.1. Исследование и выбор подходящего административного решения (React Admin, Admin Bro)
  - [ ] 11.2.2. Интеграция выбранной панели с API проекта
  - [ ] 11.2.3. Настройка прав доступа и ролей в административной панели
- [ ] 11.3. Улучшение безопасности:
  - [ ] 11.3.1. Аудит безопасности API и клиентской части
  - [ ] 11.3.2. Внедрение ограничений на запросы (rate limiting)
  - [ ] 11.3.3. Улучшение валидации данных на стороне сервера

## 12. Тестирование и подготовка к развертыванию

### 12.1. Тестирование функциональности
- [ ] 12.1.1. Тестирование аутентификации и авторизации
- [ ] 12.1.2. Тестирование работы с книгами
- [ ] 12.1.3. Тестирование работы с категориями
- [ ] 12.1.4. Тестирование пользовательских функций
- [ ] 12.1.5. Тестирование административных функций

### 12.2. Интеграционное тестирование
- [ ] 12.2.1. Тестирование взаимодействия фронтенда и бэкенда
- [ ] 12.2.2. Тестирование транзакций и обработки ошибок
- [ ] 12.2.3. Тестирование взаимодействия с базой данных
- [ ] 12.2.4. Тестирование взаимодействия с облачным хранилищем

### 12.3. Тестирование производительности
- [ ] 12.3.1. Нагрузочное тестирование API
- [ ] 12.3.2. Оптимизация запросов к базе данных
- [ ] 12.3.3. Оптимизация загрузки и отображения контента

## 13. Контейнеризация и развертывание
- [ ] 13.1. Контейнеризация приложения с использованием Docker:
  - [ ] 13.1.1. Создание Dockerfile для бэкенда
  - [ ] 13.1.2. Создание Dockerfile для фронтенда
  - [ ] 13.1.3. Настройка docker-compose для локальной разработки
  - [ ] 13.1.4. Настройка многоступенчатой сборки (multi-stage build)
- [ ] 13.2. Настройка CI/CD для автоматического развертывания:
  - [ ] 13.2.1. Настройка GitHub Actions для автоматической сборки и тестирования
  - [ ] 13.2.2. Настройка автоматического развертывания на сервер
- [ ] 13.3. Документация:
  - [ ] 13.3.1. Создание документации API (Swagger/OpenAPI)
  - [ ] 13.3.2. Написание руководства пользователя
  - [ ] 13.3.3. Создание инструкции по развертыванию


